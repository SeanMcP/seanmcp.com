---
import { CollectionEntry } from "astro:content";
import { getArticles } from "src/utils";
import ReadableTime from "./ReadableTime.astro";

interface Props {
  articles: CollectionEntry<"articles">[];
  count?: number;
}

const { articles: initial, count } = Astro.props;

const articles = initial || (await getArticles(count));
---

<section>
  {
    articles.map((article) => {
      const url = `/articles/${article.slug}`;
      return (
        <article data-url={url}>
          {/* Added for styling. Find a better way. */}
          <div>
            <ReadableTime date={article.data.pubDate} />
          </div>
          <a href={url}>
            {article.data.flags?.includes("DRAFT") && "[DRAFT] "}
            {article.data.flags?.includes("RSS-ONLY") && "[RSS-ONLY] "}
            {article.data.title}
          </a>
          <p>{article.data.description}</p>
        </article>
      );
    })
  }
</section>

<style>
  article {
    display: grid;
    gap: 0.5rem;
  }

  article:not(:first-child) {
    margin-top: 2rem;
  }

  article > * {
    margin: 0;
  }

  article a {
    font-weight: bold;
  }

  @media screen and (min-width: 600px) {
    article {
      grid-template-columns: 10rem auto;
    }

    article div {
      grid-row: 1 / span 2;
    }
  }
</style>

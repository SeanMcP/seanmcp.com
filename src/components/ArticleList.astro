---
import { type CollectionEntry } from "astro:content";
import { getArticles, getArticleTitle } from "src/utils";
import ReadableTime from "./ReadableTime.astro";

interface Props {
  articles?: CollectionEntry<"articles">[];
  count?: number;
}

const { articles: initial, count } = Astro.props;

const articles =
  initial || (await getArticles({ count, excludeRSSOnlyInProd: true }));
---

<section class="stack(l)">
  {
    articles.map((article) => {
      const url = `/articles/${article.slug}`;
      const data = {...article.data};
      if (!data.title) {
        data.title = `Note #${article.slug}`;
      }
      return (
        <article class="stack(xs)" data-url={url}>
          <div class="line(xs)">
            <a href={url}>{getArticleTitle(data)}</a>
            <ReadableTime
              date={article.data.updatedDate || article.data.pubDate}
              style="color: var(--lighter-text-color);"
            />
          </div>
          {article.data.description && <p>{article.data.description}</p>}
        </article>
      );
    })
  }
</section>

<style>
  article a {
    font-weight: bold;
  }
</style>
